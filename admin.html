<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - QuickFix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Bootstrap 5 JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      background-color: #f4f6f9;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .navbar {
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .summary-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      transition: 0.3s;
    }

    .summary-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .summary-card h5 {
      margin-bottom: 10px;
      color: #555;
    }

    .card .fs-4 {
      margin: 0;
    }

    table thead th {
      background-color: #343a40;
      color: white;
    }

    .chart-wrapper {
      max-width: 400px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .table-wrapper {
      background-color: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">QuickFix Admin Panel</span>
      <button class="btn btn-danger" onclick="logout()">Logout</button>
    </div>
  </nav>

  <div class="container">

    <!-- Chart Overview -->
    <div class="mb-5 chart-wrapper text-center">
      <h4 class="mb-3">Order Overview</h4>
      <canvas id="orderChart" height="200"></canvas>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="summary-card p-4 border-start border-success border-5">
          <h5>Total Orders</h5>
          <p class="fs-4 fw-bold text-dark" id="totalOrders">30</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card p-4 border-start border-warning border-5">
          <h5>Pending Orders</h5>
          <p class="fs-4 fw-bold text-warning" id="pendingOrders">5</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="summary-card p-4 border-start border-success border-5">
          <h5>Completed Orders</h5>
          <p class="fs-4 fw-bold text-success" id="completedOrders">22</p>
        </div>
      </div>
    </div>

    <!-- Order Management Section -->
<div class="table-wrapper mb-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Manage Orders</h4>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#orderModal">+ Add Order</button>
  </div>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Customer</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Service</th>
        <th>Status</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="orderTable"></tbody>
  </table>
</div>

<!-- Modal for Add/Edit -->
<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="orderForm" class="modal-content" onsubmit="handleSubmit(event)">
      <div class="modal-header">
        <h5 class="modal-title" id="orderModalLabel">Add/Edit Order</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editIndex" />
        
        <div class="mb-3">
          <label class="form-label">Customer Name</label>
          <input type="text" class="form-control" id="customerName" required />
        </div>

        <div class="mb-3">
          <label class="form-label">Address</label>
          <textarea class="form-control" id="customerAddress" rows="2" required></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Phone</label>
          <input type="tel" class="form-control" id="customerPhone" required />
        </div>
        <div class="mb-3">
  <label class="form-label">Service</label>
  <select class="form-select" id="customerService" multiple required>
    <optgroup label="Installation & Dismantling">
      <option value="Installation">AC Installation (৳ 1,500 – ৳ 2,000)</option>
      <option value="Dismantling">AC Dismantling (৳ 1,000 – ৳ 1,500)</option>
      <option value="Combo">Installation + Dismantling Combo (৳ 2,200 – ৳ 2,800)</option>
      <option value="CopperPipe">Extra Copper Pipe (per foot) (৳ 150 – ৳ 200)</option>
      <option value="Freon">Freon Gas Refill (৳ 1,200 – ৳ 1,800)</option>
    </optgroup>

    <optgroup label="Repair Services">
      <option value="BasicRepair">Basic Repair Service (৳ 800 – ৳ 1,200)</option>
      <option value="CompressorRepair">Compressor Repair/Replacement (৳ 2,000 – ৳ 4,500)</option>
      <option value="FreonRepair">Freon Gas Refill (৳ 1,200 – ৳ 1,800)</option>
      <option value="ElectricalRepair">Electrical Parts Replacement (৳ 500 – ৳ 2,000)</option>
      <option value="FanMotorRepair">Fan Motor Repair (৳ 700 – ৳ 1,500)</option>
    </optgroup>

    <optgroup label="Cleaning Services">
      <option value="BasicCleaning">Basic AC Cleaning (৳ 700 – ৳ 1,000)</option>
      <option value="DeepCleaning">Deep Cleaning (Coils & Filters) (৳ 1,200 – ৳ 1,800)</option>
      <option value="Sanitizing">Sanitizing & Deodorizing (৳ 1,000 – ৳ 1,500)</option>
    </optgroup>
  </select>
</div>

        <div class="mb-3">
          <label class="form-label">Status</label>
          <select class="form-select" id="customerStatus" required>
            <option value="Pending">Pending</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Date</label>
          <input type="date" class="form-control" id="customerDate" required />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Order</button>
      </div>
    </form>
  </div>
</div>



    <!-- Placeholder -->
    <div class="table-wrapper">
      <h4>Customer Management</h4>
      <p class="text-muted">Coming soon: list of registered customers, ratings, feedback, etc.</p>
    </div>
  </div>

  <!-- Chart Script -->
  <script>
    if (sessionStorage.getItem('isAdminLoggedIn') !== 'true') {
      window.location.href = 'index.html';
    }

    function logout() {
      sessionStorage.removeItem('isAdminLoggedIn');
      alert("Logged out");
      window.location.href = "index.html";
    }

    const orderData = {
      labels: ['Pending', 'Completed', 'Cancelled'],
      datasets: [{
        data: [5, 22, 3],
        backgroundColor: ['#ffc107', '#198754', '#dc3545'],
        hoverOffset: 8
      }]
    };

    new Chart(document.getElementById('orderChart'), {
      type: 'doughnut',
      data: orderData,
      options: {
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  </script>
<script>
let orders = [
  {
    customer: "Tanvir Hossain",
    address: "House 123, Road 4, Dhaka",
    phone: "017xxxxxxxx",
    service: "AC Installation",
    status: "Pending",
    date: "2025-07-05"
  },
  {
    customer: "Shakil Ahmed",
    address: "Apartment 56B, Chattogram",
    phone: "018xxxxxxxx",
    service: "Freon Gas Refill",
    status: "Completed",
    date: "2025-07-04"
  },
  {
    customer: "Sadia Khan",
    address: "Sector 10, Khulna",
    phone: "019xxxxxxxx",
    service: "Fan Motor Repair",
    status: "Cancelled",
    date: "2025-07-03"
  }
];

function getStatusColor(status) {
  switch (status) {
    case "Pending": return "warning";
    case "Completed": return "success";
    case "Cancelled": return "danger";
    default: return "secondary";
  }
}

function handleSubmit(event) {
  event.preventDefault();

  // Collect selected services as an array
  const serviceSelect = document.getElementById("customerService");
  const selectedServices = Array.from(serviceSelect.selectedOptions).map(opt => opt.value);

  const index = document.getElementById("editIndex").value;

  const newOrder = {
    customer: document.getElementById("customerName").value,
    address: document.getElementById("customerAddress").value,
    phone: document.getElementById("customerPhone").value,
    service: selectedServices, // now an array
    status: document.getElementById("customerStatus").value,
    date: document.getElementById("customerDate").value
  };

  if (index === "") {
    orders.push(newOrder);
  } else {
    orders[index] = newOrder;
  }

  // Hide modal
  const modalEl = document.getElementById("orderModal");
  const modalInstance = bootstrap.Modal.getInstance(modalEl);
  if (modalInstance) modalInstance.hide();

  document.getElementById("orderForm").reset();
  document.getElementById("editIndex").value = "";
  renderOrders();
}

function editOrder(index) {
  const order = orders[index];
  document.getElementById("editIndex").value = index;
  document.getElementById("customerName").value = order.customer;
  document.getElementById("customerAddress").value = order.address || "";
  document.getElementById("customerPhone").value = order.phone;

  // Clear all selected options first
  const serviceSelect = document.getElementById("customerService");
  Array.from(serviceSelect.options).forEach(option => {
    option.selected = false;
  });

  // Select options matching order.service array
  if (Array.isArray(order.service)) {
    order.service.forEach(svc => {
      const option = Array.from(serviceSelect.options).find(opt => opt.value === svc);
      if (option) option.selected = true;
    });
  } else if (typeof order.service === "string") {
    // fallback if old single string
    const option = Array.from(serviceSelect.options).find(opt => opt.value === order.service);
    if (option) option.selected = true;
  }

  document.getElementById("customerStatus").value = order.status;
  document.getElementById("customerDate").value = order.date;

  new bootstrap.Modal(document.getElementById("orderModal")).show();
}

function deleteOrder(index) {
  if (confirm("Are you sure you want to delete this order?")) {
    orders.splice(index, 1);
    renderOrders();
  }
}

function renderOrders() {
  const tbody = document.getElementById("orderTable");
  tbody.innerHTML = "";
  orders.forEach((order, index) => {
    const serviceText = Array.isArray(order.service) ? order.service.join(", ") : order.service;

    tbody.innerHTML += `
      <tr>
        <td>${index + 1}</td>
        <td>${order.customer}</td>
        <td>${order.address || ""}</td>
        <td>${order.phone}</td>
        <td>${serviceText}</td>
        <td><span class="badge bg-${getStatusColor(order.status)}">${order.status}</span></td>
        <td>${order.date}</td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="editOrder(${index})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteOrder(${index})">Delete</button>
        </td>
      </tr>
    `;
  });
}

// Initial render
renderOrders();
</script>

</body>
</html>
